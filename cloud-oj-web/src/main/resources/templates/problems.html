<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="include::common_head(~{::title}, ~{}, ~{}, ~{})">
    <meta charset="UTF-8">
    <title>题目列表</title>
</head>
<body>
<div th:replace="include::top"></div>
<div class="layui-container">
    <div class="layui-form-item" style="margin-top: 25px">
        <label for="keyword" class="layui-form-label">搜索题目:</label>
        <div class="layui-input-inline">
            <input id="keyword" class="layui-input" placeholder="输入题目名称" type="text" autocomplete="off">
        </div>
        <button onclick="search(this.text)" class="layui-btn">搜 索</button>
    </div>
    <!-- 题目列表 -->
    <table id="problems">

    </table>
</div>
<script type="text/html" id="titleTpl">
    <a href="./commit?problemId={{d.problemId}}" class="layui-table-link">{{d.title}}</a>
</script>
<script type="text/html" id="categoryTpl">
    <span class="label bg-green">
        {{d.category}}
    </span>
</script>
<script>
    let problemsTable;

    layui.use(['table', 'element'], () => {
        let element = layui.element;
        element.init();
        let table = layui.table;
        problemsTable = table.render({
            elem: '#problems',
            url: '../api/manager/problem',
            parseData: (res) => {
                return {
                    "code": 0,
                    "count": res === undefined ? 0 : res.count,
                    "data": res === undefined ? null : res.data
                }
            },
            skin: 'nob',
            size: 'lg',
            even: true,
            page: true,
            limit: 15,
            limits: [10, 15, 20, 25, 30],
            cols: [
                [
                    {field: 'problemId', title: '编号', width: '15%'},
                    {field: 'title', title: '题目名称', width: '40%', templet: '#titleTpl'},
                    {field: 'category', title: '标签', width: '25%', templet: '#categoryTpl'},
                    {field: 'createAt', title: '创建时间', width: '20%'}
                ]
            ]
        });
    });

    let $search = $('#keyword');

    $search.keydown((e) => {
        if (e.keyCode === 13)
            search();
    });

    function search() {
        let keyword = $search.val();
        console.log(keyword);
        problemsTable.reload({
            where: {
                keyword: keyword
            }
        });
    }

    $('#nav-problems').addClass("layui-this");
</script>
</body>
</html>