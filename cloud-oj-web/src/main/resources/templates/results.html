<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head th:replace="include::common_head(~{::title}, ~{}, ~{}, ~{})">
    <meta charset="UTF-8">
    <title>提交记录</title>
</head>
<body>
<div th:replace="include::top"></div>
<div class="layui-container">
    <table id="results" lay-filter="results">

    </table>
</div>
<script type="text/html" id="titleTpl">
    <a href="./commit?problemId={{d.problemId}}" class="layui-table-link">{{d.title}}</a>
</script>
<script type="text/html" id="resultTpl">
    {{# if (d.result == '完全正确') { }}
    <span class="bg-green label">{{d.result}}</span>
    {{# } else if (d.result == '答案错误') { }}
    <span class="bg-red label">{{d.result}}</span>
    {{# } else if (d.result == '编译错误') { }}
    <span class="bg-grey label">{{d.result}}</span>
    {{# } else { }}
    <span class="bg-yellow label">{{d.result}}({{d.passRate * 100}})</span>
    {{# } }}
</script>
<script type="text/html" id="languageTpl">
    <span class="bg-blue label">
        <span class="iconfont {{iconMap.get(d.language)}}"></span>
        {{d.language}}
    </span>
</script>
<script type="text/html" id="timeTpl">
    <span>{{d.time}} ms</span>
</script>
<script type="text/html" id="opt-toolbar">
    <button class="layui-btn layui-btn-primary layui-btn-sm" lay-event="see-code">查看代码</button>
</script>
<script>
    let table;
    $(document).ready(() => {
        layui.use(['table', 'element'], () => {
            let element = layui.element;
            table = layui.table;
            element.init();
        });

        table.render({
            elem: '#results',
            url: baseUrl + '/api/manager/result',
            where: {
                userId: user.userId
            },
            headers: {token: user.token},
            parseData: (res) => {
                return {
                    "code": 0,
                    "count": res === undefined ? 0 : res.count,
                    "data": res === undefined ? null : res.data
                }
            },
            skin: 'nob',
            size: 'lg',
            even: true,
            page: true,
            limit: 15,
            limits: [10, 15, 20, 25, 30],
            cols: [
                [
                    {field: 'problemId', title: '题目编号', width: '10%', align: 'center'},
                    {field: 'title', title: '题目名称', width: '25%', templet: '#titleTpl'},
                    {title: '操作', width: '15%', align: 'center', toolbar: '#opt-toolbar'},
                    {field: 'language', title: '编程语言', width: '15%', templet: '#languageTpl'},
                    {field: 'result', title: '结果', width: '15%', align: 'center', templet: '#resultTpl'},
                    {field: 'time', title: '运行时间', width: '10%', templet: '#timeTpl'},
                    {field: 'submitTime', title: '提交时间', width: '10%'}
                ]
            ]
        });

        table.on('tool(results)', (obj) => {
            if (obj.event === 'see-code') {
                layer.open({
                    type: 1,
                    title: '代码',
                    area: ['600px', '700px'],
                    closeButton: true,
                    content: '<textarea readonly="readonly" class="layui-textarea"' +
                        ' style="position: absolute; top: 0; bottom: 0;" id="code">'
                        + obj.data.code + '</textarea>'
                });
            }
        });
    });

    $('#nav-commit').addClass('layui-this');
</script>
</body>
</html>