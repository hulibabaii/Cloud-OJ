<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.cloudli.managerservice.dao.ContestDao">
    <select id="getAllCount" resultType="java.lang.Long">
        select count(contest_id)
        from contest
    </select>

    <select id="getAllContest" resultType="top.cloudli.managerservice.model.Contest">
        select *
        from contest
        limit #{start}, #{limit}
    </select>

    <select id="getStartedCount" resultType="java.lang.Long">
        select count(contest_id)
        from contest
        where start_at &lt;= now()
    </select>

    <select id="getStartedContest" resultType="top.cloudli.managerservice.model.Contest">
        select *
        from contest
        where start_at &lt;= now()
        limit #{start}, #{limit}
    </select>

    <select id="getProblemsCount" resultType="java.lang.Long">
        select count(*)
        from contest_problem
        where contest_id = #{contestId}
    </select>

    <select id="getProblems" resultType="top.cloudli.managerservice.model.Problem">
        select *
        from contest_problem
        where contest_id = #{contestId}
        limit #{start}, #{limit}
    </select>

    <select id="getNotInContestCount" resultType="java.lang.Long">
        select count(problem_id)
        from problem
        where problem_id not in (select problem_id from contest_problem where contest_id = #{contestId})
          and enable = false
    </select>

    <select id="getProblemsNotInContest" resultType="top.cloudli.managerservice.model.Problem">
        select *
        from problem
        where problem_id not in (select problem_id from contest_problem where contest_id = #{contestId})
          and enable = false
        limit #{start}, #{limit}
    </select>

    <insert id="addContest" parameterType="top.cloudli.managerservice.model.Contest">
        insert into contest(contest_name, start_at, end_at)
            value (#{contestName}, #{startAt}, #{endAt})
    </insert>

    <update id="updateContest" parameterType="top.cloudli.managerservice.model.Contest">
        update contest
        set contest_name = #{contestName},
            start_at     = #{startAt},
            end_at       = #{endAt}
        where contest_id = #{contestId}
    </update>

    <delete id="deleteContest">
        delete
        from contest
        where contest_id = #{contestId}
    </delete>

    <insert id="addProblem">
        insert into `contest-problem`(contest_id, problem_id)
            value (#{contestId}, #{problemId})
    </insert>

    <delete id="deleteProblem">
        delete
        from `contest-problem`
        where contest_id = #{contestId}
          and problem_id = #{problemId}
    </delete>
</mapper>